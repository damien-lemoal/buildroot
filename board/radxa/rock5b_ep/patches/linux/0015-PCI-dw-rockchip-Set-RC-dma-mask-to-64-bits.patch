From 57bdb7a8d8e88f7c6aedfb7eee2fed4172135d4c Mon Sep 17 00:00:00 2001
From: Damien Le Moal <dlemoal@kernel.org>
Date: Wed, 13 Dec 2023 17:10:52 +0900
Subject: [PATCH 15/47] PCI: dw-rockchip: Set RC dma mask to 64-bits

Signed-off-by: Damien Le Moal <dlemoal@kernel.org>
---
 drivers/pci/controller/dwc/pcie-dw-rockchip.c | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/drivers/pci/controller/dwc/pcie-dw-rockchip.c b/drivers/pci/controller/dwc/pcie-dw-rockchip.c
index 44de95284f9e..519ee8f7c90c 100644
--- a/drivers/pci/controller/dwc/pcie-dw-rockchip.c
+++ b/drivers/pci/controller/dwc/pcie-dw-rockchip.c
@@ -621,9 +621,12 @@ static int rockchip_pcie_probe(struct platform_device *pdev)
 		pp->ops = &rockchip_pcie_host_ops;
 
 		ret = dw_pcie_host_init(pp);
-		if (!ret)
-			return 0;
-		break;
+		if (ret)
+			break;
+
+		dma_set_mask_and_coherent(dev, DMA_BIT_MASK(64));
+
+		return 0;
 	case DW_PCIE_EP_TYPE:
 		if (!IS_ENABLED(CONFIG_PCIE_ROCKCHIP_DW_EP)) {
 			ret = -ENODEV;
-- 
2.43.0

